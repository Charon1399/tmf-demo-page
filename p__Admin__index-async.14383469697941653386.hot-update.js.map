{"version":3,"sources":["p__Admin__index-async.14383469697941653386.hot-update.js","src/pages/Admin/Chat/chat.tsx"],"sourcesContent":["globalThis.makoModuleHotUpdate(\r\n  'p__Admin__index',\r\n  {\r\n    modules: {},\r\n  },\r\n  function (runtime) {\r\n    runtime._h='17429166017648039187';\nruntime.updateEnsure2Map({\"node_modules/react-dom/client.js\":[\"node_modules/react-dom/client.js\"],\"src/.umi/core/EmptyRoute.tsx\":[\"src/.umi/core/EmptyRoute.tsx\"],\"src/.umi/plugin-layout/Layout.tsx\":[\"vendors_5\",\"vendors_2\",\"vendors_3\",\"vendors_4\",\"src/.umi/plugin-layout/Layout.tsx\"],\"src/.umi/plugin-openapi/openapi.tsx\":[\"vendors_5\",\"vendors_0\",\"src/.umi/plugin-openapi/openapi.tsx\"],\"src/pages/404.tsx\":[\"p__404\"],\"src/pages/Admin/Fault/index.js\":[\"vendors_0\",\"vendors_1\",\"vendors_2\",\"vendors_3\",\"p__Admin__Fault__index\"],\"src/pages/Admin/hvac/index.js\":[\"vendors_0\",\"vendors_1\",\"vendors_2\",\"vendors_3\",\"p__Admin__hvac__index\"],\"src/pages/Admin/index.tsx\":[\"vendors_0\",\"vendors_1\",\"vendors_2\",\"vendors_3\",\"p__Admin__index\"],\"src/pages/User/Chat/index.tsx\":[\"p__User__Chat__index\"]});;\r\n  },\r\n);\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Avatar, Card, FloatButton } from 'antd';\r\nimport { RobotOutlined, CloudServerOutlined, MonitorOutlined, CodeOutlined, UserOutlined } from '@ant-design/icons';\r\nimport styles from './chat.less';\r\nimport '../index.less';\r\nimport { useAgentChat, AgentMessage } from '@/contexts/AgentChatContext';\r\nimport { RESOURCE_AGENT_STATUS_STORAGE_KEY, RESOURCE_AGENT_STATUS_TIMESTAMP_STORAGE_KEY, ResourceAgentStatus, Scenario, SCENARIO_STORAGE_KEY } from '@/contexts/constants';\r\nimport MasterAgentLog from './MasterAgentLog';\r\n\r\nconst AgentsChat: React.FC<{ changeMenu: (menu: string, collapsed: boolean) => void }> = ({ changeMenu }) => {\r\n  const { messages, loadScenario } = useAgentChat();\r\n  const [currentScenario, setCurrentScenario] = useState(Number(localStorage.getItem(SCENARIO_STORAGE_KEY)));\r\n  const [showSourceLog, setShowSourceLog] = useState(false);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  // load scenario\r\n  useEffect(() => {\r\n    if (currentScenario) {\r\n      loadScenario(currentScenario);\r\n    }\r\n\r\n    if (currentScenario === Scenario.resourceCompleted) {\r\n      setTimeout(() => {\r\n        localStorage.setItem(SCENARIO_STORAGE_KEY, Scenario.serverCanBeHibernated.toString());\r\n        setCurrentScenario(Scenario.serverCanBeHibernated);\r\n      }, 3000);\r\n    } else if (currentScenario === Scenario.serverHibernated) {\r\n      setTimeout(() => {\r\n        localStorage.setItem(SCENARIO_STORAGE_KEY, Scenario.temperatureAbnormal.toString());\r\n        setCurrentScenario(Scenario.temperatureAbnormal);\r\n      }, 3000);\r\n    } else if (currentScenario === Scenario.temperatureRecovered) {\r\n      setTimeout(() => {\r\n        localStorage.setItem(SCENARIO_STORAGE_KEY, Scenario.bssMetricAbnormal.toString());\r\n        setCurrentScenario(Scenario.bssMetricAbnormal);\r\n      }, 3000);\r\n    }\r\n  }, [loadScenario, currentScenario]);\r\n\r\n  // automatically menu change\r\n  useEffect(() => {\r\n    if (currentScenario === Scenario.orderReceived) {\r\n      const resourceStatus = localStorage.getItem(RESOURCE_AGENT_STATUS_STORAGE_KEY);\r\n      if (!resourceStatus || (resourceStatus && Number(resourceStatus) === ResourceAgentStatus.init)) {\r\n        // set resource agent status to bss plan generated\r\n        localStorage.setItem(RESOURCE_AGENT_STATUS_STORAGE_KEY, ResourceAgentStatus.bssPlanGenerated.toString());\r\n        let statusTimestamps = new Map();\r\n        const statusTimestampsStr = localStorage.getItem(RESOURCE_AGENT_STATUS_TIMESTAMP_STORAGE_KEY);\r\n        if (statusTimestampsStr && statusTimestampsStr !== '[]') {\r\n          statusTimestamps = new Map(JSON.parse(statusTimestampsStr));\r\n        }\r\n        statusTimestamps.set(ResourceAgentStatus.bssPlanGenerated.toString(), new Date().toLocaleString());\r\n        localStorage.setItem(RESOURCE_AGENT_STATUS_TIMESTAMP_STORAGE_KEY, JSON.stringify(Array.from(statusTimestamps.entries())));\r\n      }\r\n      // setTimeout(() => {\r\n      //   changeMenu('resource-agent', true);\r\n      // }, 3000);\r\n    } else if (currentScenario === Scenario.temperatureAbnormal) {\r\n      setTimeout(() => {\r\n        changeMenu('assurance-agent', true);\r\n      }, 2000);\r\n    } else if (currentScenario === Scenario.serverCanBeHibernated) {\r\n      setTimeout(() => {\r\n        changeMenu('assurance-agent', true);\r\n      }, 2000);\r\n    } else if (currentScenario === Scenario.bssMetricAbnormal) {\r\n      setTimeout(() => {\r\n        changeMenu('assurance-agent', true);\r\n      }, 2000);\r\n    }\r\n  }, [currentScenario])\r\n\r\n  const scrollToBottom = () => {\r\n    const scrollableCard = document.getElementById('scrollableCard');\r\n    if (scrollableCard) {\r\n      scrollableCard.scrollTop = scrollableCard.scrollHeight;\r\n    }\r\n  }\r\n\r\n  // 获取 Agent 头像\r\n  const getAgentAvatar = (type: AgentMessage['type']) => {\r\n    switch (type) {\r\n      case 'master':\r\n        return <Avatar icon={<RobotOutlined />} />;\r\n      case 'bss':\r\n        return <Avatar icon={<CloudServerOutlined />} style={{ backgroundColor: \"#6a7b8c\" }} />;\r\n      case 'resource':\r\n        return <Avatar icon={<CloudServerOutlined />} style={{ backgroundColor: \"#6a8c6a\" }} />;\r\n      case 'assurance':\r\n        return <Avatar icon={<MonitorOutlined />} style={{ backgroundColor: \"#8c6b6a\" }} />;\r\n      default:\r\n        return <Avatar icon={<RobotOutlined />} />;\r\n    }\r\n  };\r\n\r\n  const getMessageClass = (type: AgentMessage['type']) => {\r\n    switch (type) {\r\n      case 'master':\r\n        return styles.master;\r\n      case 'bss':\r\n        return styles.bss;\r\n      case 'resource':\r\n        return styles.resource;\r\n      case 'assurance':\r\n        return styles.assurance;\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className={styles.container} id={'scrollableCard'}>\r\n      {showSourceLog ? (\r\n        <FloatButton style={{ right: 64, bottom: 64 }} icon={<UserOutlined />} onClick={() => setShowSourceLog(false)} />\r\n      ) : (\r\n        <FloatButton style={{ right: 64, bottom: 64 }} icon={<CodeOutlined />} onClick={() => setShowSourceLog(true)} />\r\n      )}\r\n      {showSourceLog && <h1 className={styles.title}>Master Agent</h1>}\r\n      {showSourceLog && <MasterAgentLog />}\r\n      {!showSourceLog && (\r\n        <div className={styles.messages}>\r\n          {messages.map((message) => (\r\n            <div\r\n              key={message.id}\r\n              className={`${styles.message} ${getMessageClass(message.type)} ${message.type === 'master' ? styles.master : styles.other}`}\r\n            >\r\n              <div className={styles.avatar}>{getAgentAvatar(message.type)}</div>\r\n              <div className={styles.messageContent}>\r\n                <div className={styles.messageHeader}>\r\n                  <span className={styles.sender}>{message.sender}</span>\r\n                  <span className={styles.timestamp}>{message.timestamp}</span>\r\n                </div>\r\n                <div className={styles.messageText}>{message.content}</div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default AgentsChat;\r\n"],"names":[],"mappings":"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"}